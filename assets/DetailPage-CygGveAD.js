import{j as e,L as V}from"./index-zF6Hmcwz.js";import{e as b,T as l,a as D,V as C,b as L}from"./financialRepository-DohCN_Ha.js";import{b as i,C as v,d as N,e as Q,f as T,g as H,h as k,p as P,i as K,P as F,j as I,k as _,u as O}from"./vendor-XtUg-c2N.js";const B=s=>{const[a,t]=i.useState([]),[c,n]=i.useState(null),[o,m]=i.useState([]),[d,u]=i.useState(!0),[g,h]=i.useState(null);return i.useEffect(()=>{const x=async()=>{u(!0),h(null);try{const f=await b.getQuotations();if(t(f),f.forEach(r=>{b.saveQuotationHistory(r)}),s){const r=f.find(p=>p.id===s)||null;if(n(r),r){const p=b.getQuotationHistory(s);m(p)}}}catch(f){console.error("Erro ao buscar dados financeiros:",f),h("Não foi possível carregar os dados financeiros. Tente novamente mais tarde.")}finally{u(!1)}};x();const y=setInterval(x,s?6e4:3e5);return()=>clearInterval(y)},[s]),{data:a,selectedQuotation:c,history:o,loading:d,error:g}},R="label";function w(s,a){typeof s=="function"?s(a):s&&(s.current=a)}function M(s,a){const t=s.options;t&&a&&Object.assign(t,a)}function E(s,a){s.labels=a}function S(s,a){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:R;const c=[];s.datasets=a.map(n=>{const o=s.datasets.find(m=>m[t]===n[t]);return!o||!n.data||c.includes(o)?{...n}:(c.push(o),Object.assign(o,n),o)})}function $(s){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R;const t={labels:[],datasets:[]};return E(t,s.labels),S(t,s.datasets,a),t}function z(s,a){const{height:t=150,width:c=300,redraw:n=!1,datasetIdKey:o,type:m,data:d,options:u,plugins:g=[],fallbackContent:h,updateMode:x,...y}=s,f=i.useRef(null),r=i.useRef(null),p=()=>{f.current&&(r.current=new v(f.current,{type:m,data:$(d,o),options:u&&{...u},plugins:g}),w(a,r.current))},j=()=>{w(a,null),r.current&&(r.current.destroy(),r.current=null)};return i.useEffect(()=>{!n&&r.current&&u&&M(r.current,u)},[n,u]),i.useEffect(()=>{!n&&r.current&&E(r.current.config.data,d.labels)},[n,d.labels]),i.useEffect(()=>{!n&&r.current&&d.datasets&&S(r.current.config.data,d.datasets,o)},[n,d.datasets]),i.useEffect(()=>{r.current&&(n?(j(),setTimeout(p)):r.current.update(x))},[n,u,d.labels,d.datasets,x]),i.useEffect(()=>{r.current&&(j(),setTimeout(p))},[m]),i.useEffect(()=>(p(),()=>j()),[]),N.createElement("canvas",{ref:f,role:"img",height:t,width:c,...y},h)}const A=i.forwardRef(z);function G(s,a){return v.register(a),i.forwardRef((t,c)=>N.createElement(A,{...t,ref:c,type:s}))}const J=G("line",Q);v.register(T,H,k,P,K,F,I);const U=({history:s})=>{if(s.length===0)return e.jsx("div",{className:"p-6 rounded text-center",children:e.jsx("p",{className:"text-gray-100",children:"Não há dados suficientes para exibir o gráfico."})});const a=s.map(o=>new Date(o.timestamp||0).toLocaleDateString()),t=s.map(o=>o.sell||o.buy||0),c={labels:a,datasets:[{label:"Valor ao longo do tempo",data:t,fill:!1,borderColor:"#727cf5",color:"#f2f3f5",tension:.4}]},n={responsive:!0,plugins:{legend:{display:!1}},scales:{x:{ticks:{color:"#f2f3f5",maxRotation:45,minRotation:45},grid:{color:"#444"}},y:{ticks:{color:"#f2f3f5"},grid:{color:"#444"}}}};return e.jsx("div",{className:"w-full h-64 md:h-96",children:e.jsx(J,{data:c,options:n})})},W=()=>{const{id:s}=_(),a=O(),{selectedQuotation:t,history:c,loading:n,error:o}=B(s);return n?e.jsx("div",{className:"min-h-screen flex justify-center items-center bg-secondary-700",children:e.jsx(V,{})}):o||!t?e.jsxs("div",{className:"min-h-screen flex flex-col justify-center items-center bg-secondary-800",children:[e.jsx("div",{className:"text-xl mb-4",children:o||"Cotação não encontrada"}),e.jsx("button",{onClick:()=>a("/"),className:"bg-primary-500 hover:bg-primary-700 text-secondary-200 font-bold py-2 px-4 rounded",children:"Voltar para a página inicial"})]}):e.jsx("div",{className:"min-h-screen",children:e.jsxs("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"shadow overflow-hidden sm:rounded-lg mb-6",children:e.jsx("div",{className:"border-t border-secondary-700",children:e.jsxs(l,{striped:!0,hoverable:!0,children:[e.jsx(l.Head,{children:e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:2,children:e.jsx("h3",{className:"text-lg font-medium",children:"Informações da Cotação"})})})}),e.jsxs(l.Body,{children:[e.jsxs(l.Row,{children:[e.jsx(l.Cell,{children:"Nome"}),e.jsx(l.Cell,{children:t.name})]}),e.jsxs(l.Row,{children:[e.jsx(l.Cell,{children:"Tipo"}),e.jsx(D,{type:t.type})]}),e.jsxs(l.Row,{children:[e.jsx(l.Cell,{children:"Valor de Compra"}),e.jsx(C,{type:t.type,buy:t.buy,points:t.points,source:t.source})]}),e.jsxs(l.Row,{children:[e.jsx(l.Cell,{children:"Valor de Venda"}),e.jsx(C,{type:t.type,buy:t.sell,points:t.points,source:t.source})]}),e.jsxs(l.Row,{children:[e.jsx(l.Cell,{children:"Variação"}),e.jsx(L,{variation:t.variation})]})]})]})})}),e.jsxs("div",{className:"bg-secondary-700 shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-100",children:"Histórico de Valores"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Evolução da cotação desde o início da sessão"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-secondary-800 p-4 rounded text-center",children:e.jsx(U,{history:c,type:t.type})})})]})]})})},q=()=>e.jsx(W,{});export{q as default};
//# sourceMappingURL=DetailPage-CygGveAD.js.map
