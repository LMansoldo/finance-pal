import{M as R,j as e,L as O}from"./index-C_mE_UBq.js";import{e as b,F as m,f as A,g as N,h as L,T as c,a as V,V as w,b as $}from"./financialRepository-B7d_6N1-.js";import{b as l,C as v,d as E,e as B,f as U,g as _,h as F,p as k,i as K,P as Q,j as H,k as P,u as Y,L as z}from"./vendor-vz8ujiOm.js";const M=t=>{const[s,r]=l.useState([]),[u,a]=l.useState(null),[d,h]=l.useState([]),[f,x]=l.useState(!0),[C,n]=l.useState(null);return l.useEffect(()=>{const i=async()=>{x(!0),n(null);try{const g=await b.getQuotations();if(r(g),g.forEach(o=>{b.saveQuotationHistory(o)}),t){const o=g.find(p=>p.id===t)||null;if(a(o),o){const p=b.getQuotationHistory(t);h(p)}}}catch(g){console.error(`${R.FINANCIAL_DATA_ERROR}`,g),n(`${R.FINANCIAL_DATA_NOT_FOUND}`)}finally{x(!1)}};i();const j=setInterval(i,t?6e4:3e5);return()=>clearInterval(j)},[t]),{data:s,selectedQuotation:u,history:d,loading:f,error:C}},S="label";function T(t,s){typeof t=="function"?t(s):t&&(t.current=s)}function G(t,s){const r=t.options;r&&s&&Object.assign(r,s)}function I(t,s){t.labels=s}function D(t,s){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:S;const u=[];t.datasets=s.map(a=>{const d=t.datasets.find(h=>h[r]===a[r]);return!d||!a.data||u.includes(d)?{...a}:(u.push(d),Object.assign(d,a),d)})}function J(t){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:S;const r={labels:[],datasets:[]};return I(r,t.labels),D(r,t.datasets,s),r}function W(t,s){const{height:r=150,width:u=300,redraw:a=!1,datasetIdKey:d,type:h,data:f,options:x,plugins:C=[],fallbackContent:n,updateMode:i,...j}=t,g=l.useRef(null),o=l.useRef(null),p=()=>{g.current&&(o.current=new v(g.current,{type:h,data:J(f,d),options:x&&{...x},plugins:C}),T(s,o.current))},y=()=>{T(s,null),o.current&&(o.current.destroy(),o.current=null)};return l.useEffect(()=>{!a&&o.current&&x&&G(o.current,x)},[a,x]),l.useEffect(()=>{!a&&o.current&&I(o.current.config.data,f.labels)},[a,f.labels]),l.useEffect(()=>{!a&&o.current&&f.datasets&&D(o.current.config.data,f.datasets,d)},[a,f.datasets]),l.useEffect(()=>{o.current&&(a?(y(),setTimeout(p)):o.current.update(i))},[a,x,f.labels,f.datasets,i]),l.useEffect(()=>{o.current&&(y(),setTimeout(p))},[h]),l.useEffect(()=>(p(),()=>y()),[]),E.createElement("canvas",{ref:g,role:"img",height:r,width:u,...j},n)}const X=l.forwardRef(W);function Z(t,s){return v.register(s),l.forwardRef((r,u)=>E.createElement(X,{...r,ref:u,type:t}))}const q=Z("line",B);v.register(U,_,F,k,K,Q,H);const ee=({history:t,type:s})=>{const r=l.useRef(null);if(l.useEffect(()=>{const n=r.current,i=new ResizeObserver(()=>{n&&window.dispatchEvent(new Event("resize"))});return n&&i.observe(n),()=>{n&&i.unobserve(n)}},[]),t.length===0)return e.jsx("div",{className:"p-6 rounded text-center",children:e.jsx("p",{className:"text-gray-100",children:R.INSUFICIENT_CHART_DATA})});const u=t.map(n=>new Date(n.timestamp||0).toLocaleDateString()),a=t.map(n=>n.sell||n.buy||0),h=s===m.CURRENCY&&t.length>0&&t[0].id?t[0].id:s===m.BITCOIN?"BTC":(s===m.STOCK,"USD"),f={labels:u,datasets:[{label:"Valor ao longo do tempo",data:a,fill:!1,borderColor:"#727cf5",color:"#f2f3f5",tension:.4}]},x={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(n){const i=n.raw;return s===m.CURRENCY?A(h,i):s===m.BITCOIN?`${i} BTC`:s===m.STOCK?`${N("USD")} ${i}`:i==null?void 0:i.toString()}}}},scales:{x:{ticks:{color:"#f2f3f5",maxRotation:45,minRotation:45},grid:{color:"#444"}},y:{type:"linear",ticks:{color:"#f2f3f5",callback:function(n){return s===m.CURRENCY?`${N(h)} ${n}`:s===m.BITCOIN?`${n} BTC`:s===m.STOCK?`${N("USD")} ${n}`:n.toString()}},grid:{color:"#444"}}}},C=()=>s===m.CURRENCY?`Cotação ${h}`:s===m.BITCOIN?"Cotação Bitcoin":s===m.STOCK?"Cotação de Ações":"Cotação";return e.jsxs("div",{ref:r,className:"w-full h-64 md:h-96 max-w-full overflow-hidden",children:[e.jsx("h3",{className:"text-center text-gray-100 mb-2",children:C()}),e.jsx(q,{data:f,options:x})]})},te=()=>{const{id:t}=P(),s=Y(),{selectedQuotation:r,history:u,loading:a,error:d}=M(t);return a?e.jsx("div",{className:"min-h-screen flex justify-center items-center bg-secondary-700",children:e.jsx(O,{})}):d||!r?e.jsxs("div",{className:"min-h-screen flex flex-col justify-center items-center bg-secondary-800",children:[e.jsx("div",{className:"text-xl mb-4",children:d||"Cotação não encontrada"}),e.jsx("button",{onClick:()=>s("/"),className:"bg-primary-500 hover:bg-primary-700 text-secondary-200 font-bold py-2 px-4 rounded",children:"Voltar para a página inicial"})]}):e.jsx("div",{className:"min-h-screen",children:e.jsxs("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"",children:e.jsxs(z,{to:"/",className:"flex items-center mb-4 gap-2 text-secondary-200 hover:text-secondary-100",children:[e.jsx(L,{}),"Voltar"]})}),e.jsx("div",{className:"shadow overflow-hidden sm:rounded-lg mb-6",children:e.jsx("div",{className:"border-t border-secondary-700",children:e.jsxs(c,{striped:!0,hoverable:!0,children:[e.jsx(c.Head,{children:e.jsx(c.Row,{children:e.jsx(c.Cell,{colSpan:2,children:e.jsx("h3",{className:"text-lg font-medium",children:"Informações da Cotação"})})})}),e.jsxs(c.Body,{children:[e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:"Nome"}),e.jsx(c.Cell,{children:r.name})]}),e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:"Tipo"}),e.jsx(V,{type:r.type})]}),e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:"Valor de Compra"}),e.jsx(w,{type:r.type,buy:r.buy,points:r.points,source:r.source})]}),e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:"Valor de Venda"}),e.jsx(w,{type:r.type,buy:r.sell,points:r.points,source:r.source})]}),e.jsxs(c.Row,{children:[e.jsx(c.Cell,{children:"Variação"}),e.jsx($,{variation:r.variation})]})]})]})})}),e.jsxs("div",{className:"bg-secondary-700 shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-100",children:"Histórico de Valores"}),e.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Evolução da cotação desde o início da sessão"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-secondary-800 p-4 rounded text-center",children:e.jsx(ee,{history:u,type:r.type})})})]})]})})},ae=()=>e.jsx(te,{});export{ae as default};
